language: c
sudo: true
script:
  - sudo apt update
  - sudo apt-get install linux-headers-$(uname -r)
  - cd phase_2/part_1/hello_os_module/
  - sudo make
  - sudo lsmod
  - sudo insmod hello_os_lkm.ko
  - sudo lsmod
  - MODULE_OUTPUT=$(sudo dmesg | tail -1 | cut -d']' -f 2)
  - if [[ $MODULE_OUTPUT == *"Hello OS"* ]]; then echo "Output test passed!"; else echo "Module output error!"; exit 1; fi
  - sudo modinfo hello_os_lkm.ko
  - sudo rmmod hello_os_lkm
  - sudo lsmod

after_success:
  - echo success